<div class="row text-center">
    <div id="app" class="col-md-12">
        <h1><?php echo $this->translate('File Connector Manager') ?></h1>
        <script type="text/x-handlebars" data-template-name="file-manager">
            {{outlet}}
        </script>
    </div>
</div>
<?php

echo $this->partial('file-connector/file-manager/partial/connectors');
echo $this->partial('file-connector/file-manager/partial/connector-create');
echo $this->partial('file-connector/file-manager/partial/sidebar-left');

//Bootstrap ember app
$this->inlineScript()->captureStart();

$apiUrl = ltrim($this->url('file_connector/api'), '/');

$shortLocale = explode("_", $this->plugin('translate')->getTranslator()->getLocale())[0];

$clientTranslations = json_encode([
    'file_manager' => [
        'label' => $this->translate('File Manager')
    ]
]);
echo <<<JS
window.App = Ember.Application.create({
    rootElement : '#app'
});

DS.RESTAdapter.reopen({
  namespace : '{$apiUrl}'
});

Em.I18n.locale = '{$shortLocale}';

Em.I18n.translations = $clientTranslations;

App.Object = Ember.Object.extend(Em.Serializable);

App.Router.map(function() {
    this.resource('connectors', { path: '/' }, function() {
        this.route('create');
        this.resource('connector', {path: '/connector/:connector_id'}, function() {
            this.route('edit');
        });
    });
});

App.ApplicationRoute = Ember.Route.extend({
    model : function() {
        {$this->emberPushToStore('connector', $this->connectors)}

        this.store.all("connector").forEach(function(connector) {
            connector.set("metadata", Em.hashToObject(connector.get("metadata"), App.Object));
        });
    }
});
JS;
$this->inlineScript()->captureEnd();
$this->inlineScript()->appendFile($this->basePath() . '/js/file-connector/app.js');
?>
